# Phase 8: ãƒªãƒƒãƒãªãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

## ãƒ•ã‚§ãƒ¼ã‚ºæ¦‚è¦

**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ğŸ”² æœªç€æ‰‹
**æ¨å®šå·¥æ•°**: 4-6æ™‚é–“
**å®Œäº†æ—¥**: -
**ä¾å­˜é–¢ä¿‚**: Phase 7

### ç›®çš„
ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã€ç”»é¢ã‚·ã‚§ã‚¤ã‚¯ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã—ã€ã‚²ãƒ¼ãƒ ã«è¦–è¦šçš„ãªé­…åŠ›ã‚’è¿½åŠ ã™ã‚‹ã€‚

### ã‚¹ã‚³ãƒ¼ãƒ—
- ãƒ•ãƒ«ãƒ¼ãƒ„åˆä½“æ™‚ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- å¤§ããªãƒ•ãƒ«ãƒ¼ãƒ„åˆä½“æ™‚ã®ç”»é¢ã‚·ã‚§ã‚¤ã‚¯
- ã‚¹ã‚¤ã‚«å®Œæˆæ™‚ã®ç‰¹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- ãƒ•ãƒ«ãƒ¼ãƒ„ã‚¹ãƒãƒ¼ãƒ³æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„
- UIè¦ç´ ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¹ã‚³ã‚¢åŠ ç®—æ™‚ã®ãƒ‘ãƒ«ã‚¹ç­‰ï¼‰
- 2.5Dæ·±åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆZè»¸ã«ã‚ˆã‚‹ã‚µã‚¤ã‚ºå¤‰åŒ–ï¼‰

## å‰ææ¡ä»¶

- Phase 7ãŒå®Œäº†ã—ã¦ã„ã‚‹
- åŸºæœ¬UIãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- åˆä½“ã‚·ã‚¹ãƒ†ãƒ ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹

## ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

### ã‚¿ã‚¹ã‚¯ 8.1: ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®åŸºç›¤å®Ÿè£…

**å„ªå…ˆåº¦**: P0
**æ¨å®šå·¥æ•°**: 1.5æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, effects

**èª¬æ˜**:
ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã€åˆä½“æ™‚ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `app/core/src/systems/particles.rs` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `Particle` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] `spawn_particles` é–¢æ•°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] `update_particles` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒæ™‚é–“çµŒéã§æ¶ˆæ»…ã™ã‚‹
- [ ] ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã«é€Ÿåº¦ã¨é‡åŠ›ãŒé©ç”¨ã•ã‚Œã‚‹

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/particles.rs
use bevy::prelude::*;

#[derive(Component)]
pub struct Particle {
    pub lifetime: f32,
    pub max_lifetime: f32,
    pub velocity: Vec2,
}

pub fn spawn_particles(
    commands: &mut Commands,
    position: Vec2,
    color: Color,
    count: u32,
) {
    use rand::Rng;
    let mut rng = rand::thread_rng();

    for _ in 0..count {
        let angle = rng.gen_range(0.0..std::f32::consts::TAU);
        let speed = rng.gen_range(50.0..200.0);
        let velocity = Vec2::new(angle.cos(), angle.sin()) * speed;

        commands.spawn((
            Particle {
                lifetime: 0.0,
                max_lifetime: rng.gen_range(0.3..0.8),
                velocity,
            },
            SpriteBundle {
                sprite: Sprite {
                    color,
                    custom_size: Some(Vec2::splat(rng.gen_range(3.0..8.0))),
                    ..default()
                },
                transform: Transform::from_xyz(position.x, position.y, 10.0),
                ..default()
            },
        ));
    }
}

pub fn update_particles(
    mut commands: Commands,
    mut query: Query<(Entity, &mut Transform, &mut Particle, &mut Sprite)>,
    time: Res<Time>,
) {
    for (entity, mut transform, mut particle, mut sprite) in query.iter_mut() {
        particle.lifetime += time.delta_seconds();

        // å¯¿å‘½ãƒã‚§ãƒƒã‚¯
        if particle.lifetime >= particle.max_lifetime {
            commands.entity(entity).despawn();
            continue;
        }

        // é€Ÿåº¦ã‚’é©ç”¨ï¼ˆé‡åŠ›åŠ¹æœï¼‰
        particle.velocity.y -= 300.0 * time.delta_seconds();
        transform.translation.x += particle.velocity.x * time.delta_seconds();
        transform.translation.y += particle.velocity.y * time.delta_seconds();

        // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
        let alpha = 1.0 - (particle.lifetime / particle.max_lifetime);
        sprite.color.set_alpha(alpha);
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [03_physics_rendering.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³5.2](../03_physics_rendering.md)

---

### ã‚¿ã‚¹ã‚¯ 8.2: åˆä½“æ™‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®çµ±åˆ

**å„ªå…ˆåº¦**: P0
**æ¨å®šå·¥æ•°**: 1æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, effects

**èª¬æ˜**:
FruitMergeEventã‚’ç›£è¦–ã—ã€åˆä½“æ™‚ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `spawn_merge_particles` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] FruitMergeEventã‚’ç›£è¦–ã—ã¦ã„ã‚‹
- [ ] ãƒ•ãƒ«ãƒ¼ãƒ„ã®è‰²ã«å¿œã˜ãŸãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] ãƒ•ãƒ«ãƒ¼ãƒ„ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°ãŒå¤‰åŒ–ã™ã‚‹
- [ ] ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒåˆä½“ä½ç½®ã‹ã‚‰æ”¾å°„çŠ¶ã«é£›ã³æ•£ã‚‹

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/particles.rs (ç¶šã)
use crate::events::*;

pub fn spawn_merge_particles(
    mut commands: Commands,
    mut merge_events: EventReader<FruitMergeEvent>,
) {
    for event in merge_events.read() {
        let color = event.fruit_type.placeholder_color();

        // ãƒ•ãƒ«ãƒ¼ãƒ„ã‚µã‚¤ã‚ºã«å¿œã˜ãŸãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°
        let particle_count = match event.fruit_type {
            FruitType::Cherry | FruitType::Strawberry => 8,
            FruitType::Grape | FruitType::Dekopon | FruitType::Persimmon => 12,
            FruitType::Apple | FruitType::Pear | FruitType::Peach => 16,
            FruitType::Pineapple | FruitType::Melon => 20,
            FruitType::Watermelon => 30,
        };

        spawn_particles(
            &mut commands,
            event.position,
            color,
            particle_count,
        );
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [03_physics_rendering.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³5.2](../03_physics_rendering.md)

---

### ã‚¿ã‚¹ã‚¯ 8.3: ç”»é¢ã‚·ã‚§ã‚¤ã‚¯ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

**å„ªå…ˆåº¦**: P1
**æ¨å®šå·¥æ•°**: 1.5æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, effects

**èª¬æ˜**:
å¤§ããªãƒ•ãƒ«ãƒ¼ãƒ„ã®åˆä½“æ™‚ã«ã‚«ãƒ¡ãƒ©ã‚’æºã‚‰ã—ã¦è¡æ’ƒã‚’æ¼”å‡ºã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `app/core/src/systems/camera_shake.rs` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `CameraShake` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] `trigger_shake_on_merge` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] `apply_camera_shake` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] å¤§ãã„ãƒ•ãƒ«ãƒ¼ãƒ„ã»ã©å¼·ãæºã‚Œã‚‹
- [ ] ã‚·ã‚§ã‚¤ã‚¯ãŒæ»‘ã‚‰ã‹ã«æ¸›è¡°ã™ã‚‹

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/camera_shake.rs
use bevy::prelude::*;
use crate::events::*;

#[derive(Component)]
pub struct CameraShake {
    pub intensity: f32,
    pub duration: f32,
    pub elapsed: f32,
}

pub fn trigger_shake_on_merge(
    mut commands: Commands,
    mut merge_events: EventReader<FruitMergeEvent>,
    camera_query: Query<Entity, With<Camera2d>>,
) {
    for event in merge_events.read() {
        // å¤§ãã„ãƒ•ãƒ«ãƒ¼ãƒ„ã®ã¿ã‚·ã‚§ã‚¤ã‚¯
        let intensity = match event.fruit_type {
            FruitType::Peach => 3.0,
            FruitType::Pineapple => 5.0,
            FruitType::Melon => 8.0,
            FruitType::Watermelon => 12.0,
            _ => continue,  // å°ã•ã„ãƒ•ãƒ«ãƒ¼ãƒ„ã¯ã‚·ã‚§ã‚¤ã‚¯ãªã—
        };

        if let Ok(camera_entity) = camera_query.get_single() {
            commands.entity(camera_entity).insert(CameraShake {
                intensity,
                duration: 0.3,
                elapsed: 0.0,
            });
        }
    }
}

pub fn apply_camera_shake(
    mut commands: Commands,
    mut query: Query<(Entity, &mut Transform, &mut CameraShake), With<Camera2d>>,
    time: Res<Time>,
) {
    use rand::Rng;
    let mut rng = rand::thread_rng();

    for (entity, mut transform, mut shake) in query.iter_mut() {
        shake.elapsed += time.delta_seconds();

        if shake.elapsed >= shake.duration {
            // ã‚·ã‚§ã‚¤ã‚¯çµ‚äº†ã€ã‚«ãƒ¡ãƒ©ã‚’ãƒªã‚»ãƒƒãƒˆ
            transform.translation.x = 0.0;
            transform.translation.y = 0.0;
            commands.entity(entity).remove::<CameraShake>();
        } else {
            // æ¸›è¡°ã‚·ã‚§ã‚¤ã‚¯
            let progress = shake.elapsed / shake.duration;
            let current_intensity = shake.intensity * (1.0 - progress);

            let offset_x = rng.gen_range(-current_intensity..current_intensity);
            let offset_y = rng.gen_range(-current_intensity..current_intensity);

            transform.translation.x = offset_x;
            transform.translation.y = offset_y;
        }
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [03_physics_rendering.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³5.3](../03_physics_rendering.md)

---

### ã‚¿ã‚¹ã‚¯ 8.4: ã‚¹ã‚¤ã‚«å®Œæˆæ™‚ã®ç‰¹åˆ¥ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

**å„ªå…ˆåº¦**: P1
**æ¨å®šå·¥æ•°**: 1æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, effects

**èª¬æ˜**:
ã‚¹ã‚¤ã‚«ãŒå®Œæˆã—ãŸéš›ã®ç‰¹åˆ¥ãªæ¼”å‡ºã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `spawn_watermelon_effect` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ã‚¤ã‚«å®Œæˆæ™‚ã«å¤§é‡ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹
- [ ] è¤‡æ•°è‰²ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ï¼ˆè™¹è‰²ï¼‰ãŒä½¿ç”¨ã•ã‚Œã‚‹
- [ ] å¼·ã„ç”»é¢ã‚·ã‚§ã‚¤ã‚¯ãŒç™ºç”Ÿã™ã‚‹
- [ ] ã‚¹ã‚¤ã‚«ã«ä¸€ç¬å…‰ã‚‹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒè¿½åŠ ã•ã‚Œã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/particles.rs (ç¶šã)
pub fn spawn_watermelon_effect(
    mut commands: Commands,
    mut merge_events: EventReader<FruitMergeEvent>,
) {
    for event in merge_events.read() {
        // ãƒ¡ãƒ­ãƒ³åŒå£«ã®åˆä½“ï¼ˆ= ã‚¹ã‚¤ã‚«èª•ç”Ÿï¼‰
        if event.fruit_type == FruitType::Melon {
            // è™¹è‰²ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            let colors = [
                Color::srgb(1.0, 0.0, 0.0),  // èµ¤
                Color::srgb(1.0, 0.5, 0.0),  // ã‚ªãƒ¬ãƒ³ã‚¸
                Color::srgb(1.0, 1.0, 0.0),  // é»„
                Color::srgb(0.0, 1.0, 0.0),  // ç·‘
                Color::srgb(0.0, 0.5, 1.0),  // é’
                Color::srgb(0.5, 0.0, 1.0),  // ç´«
            ];

            for color in colors.iter() {
                spawn_particles(
                    &mut commands,
                    event.position,
                    *color,
                    15,
                );
            }

            info!("ğŸ‰ Watermelon created!");
        }
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [01_specification.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³3.2](../01_specification.md)

---

### ã‚¿ã‚¹ã‚¯ 8.5: ã‚¹ã‚³ã‚¢åŠ ç®—æ™‚ã®ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

**å„ªå…ˆåº¦**: P2
**æ¨å®šå·¥æ•°**: 1æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, ui-effects

**èª¬æ˜**:
ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚ŒãŸéš›ã«ã‚¹ã‚³ã‚¢è¡¨ç¤ºã‚’ä¸€ç¬å¤§ããã™ã‚‹ãƒ‘ãƒ«ã‚¹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `app/ui/src/systems/animations.rs` ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] `ScorePulseAnimation` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¹ã‚³ã‚¢æ›´æ–°æ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹
- [ ] 0.2ç§’ç¨‹åº¦ã§ã‚¹ã‚±ãƒ¼ãƒ«ãŒ1.0 â†’ 1.2 â†’ 1.0ã«å¤‰åŒ–ã™ã‚‹
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ»‘ã‚‰ã‹ã§ã‚ã‚‹

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/ui/src/systems/animations.rs
use bevy::prelude::*;
use suika_game_core::*;
use crate::screens::hud::ScoreText;

#[derive(Component)]
pub struct ScorePulseAnimation {
    pub elapsed: f32,
    pub duration: f32,
}

pub fn trigger_score_pulse(
    mut commands: Commands,
    game_state: Res<GameState>,
    score_query: Query<Entity, With<ScoreText>>,
) {
    if game_state.is_changed() && game_state.score > 0 {
        for entity in score_query.iter() {
            commands.entity(entity).insert(ScorePulseAnimation {
                elapsed: 0.0,
                duration: 0.2,
            });
        }
    }
}

pub fn animate_score_pulse(
    mut commands: Commands,
    mut query: Query<(Entity, &mut Transform, &mut ScorePulseAnimation)>,
    time: Res<Time>,
) {
    for (entity, mut transform, mut anim) in query.iter_mut() {
        anim.elapsed += time.delta_seconds();

        if anim.elapsed >= anim.duration {
            transform.scale = Vec3::splat(1.0);
            commands.entity(entity).remove::<ScorePulseAnimation>();
        } else {
            // Sinæ³¢ã§ãƒ‘ãƒ«ã‚¹
            let t = anim.elapsed / anim.duration;
            let scale = 1.0 + (t * std::f32::consts::PI).sin() * 0.2;
            transform.scale = Vec3::splat(scale);
        }
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [04_ui_ux.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³4.1](../04_ui_ux.md)

---

### ã‚¿ã‚¹ã‚¯ 8.6: 2.5Dæ·±åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã®å®Ÿè£…

**å„ªå…ˆåº¦**: P2
**æ¨å®šå·¥æ•°**: 1æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, rendering

**èª¬æ˜**:
ãƒ•ãƒ«ãƒ¼ãƒ„ã®Zåº§æ¨™ã«å¿œã˜ã¦ã‚µã‚¤ã‚ºã‚’å¤‰åŒ–ã•ã›ã€å¥¥è¡Œãæ„Ÿã‚’æ¼”å‡ºã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `apply_depth_scale` ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ•ãƒ«ãƒ¼ãƒ„ã®Zåº§æ¨™ãŒ-100ã€œ100ã®ç¯„å›²ã§å¤‰å‹•ã™ã‚‹
- [ ] Zåº§æ¨™ãŒå¤§ãã„ï¼ˆæ‰‹å‰ï¼‰ã»ã©ã‚¹ãƒ—ãƒ©ã‚¤ãƒˆãŒå¤§ããè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¹ã‚±ãƒ¼ãƒ«å¤‰åŒ–ãŒè‡ªç„¶ã§ã‚ã‚‹ï¼ˆ0.9ã€œ1.1å€ç¨‹åº¦ï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å½±éŸ¿ãŒãªã„

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/effects.rs (è¿½åŠ )
pub fn apply_depth_scale(
    mut query: Query<(&mut Transform, &Sprite), With<Fruit>>,
) {
    for (mut transform, _sprite) in query.iter_mut() {
        // Zåº§æ¨™ã«åŸºã¥ãã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ-100 ~ 100ã®ç¯„å›²ã‚’æƒ³å®šï¼‰
        let depth_factor = 1.0 + (transform.translation.z / 1000.0);
        let depth_scale = depth_factor.clamp(0.9, 1.1);

        // XYã‚¹ã‚±ãƒ¼ãƒ«ã®ã¿å¤‰æ›´ï¼ˆZã¯ä¿æŒï¼‰
        let current_z_scale = transform.scale.z;
        transform.scale = Vec3::new(depth_scale, depth_scale, current_z_scale);
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [03_physics_rendering.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³4](../03_physics_rendering.md)

---

### ã‚¿ã‚¹ã‚¯ 8.7: ãƒ•ãƒ«ãƒ¼ãƒ„ã‚¹ãƒãƒ¼ãƒ³æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ”¹å–„

**å„ªå…ˆåº¦**: P2
**æ¨å®šå·¥æ•°**: 0.5æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, effects

**èª¬æ˜**:
æ—¢å­˜ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã«åŠ ãˆã¦ã€å›è»¢ã‚„ãƒã‚¦ãƒ³ã‚¹ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] `MergeAnimation` ãŒæ‹¡å¼µã•ã‚Œã¦ã„ã‚‹
- [ ] å‡ºç¾æ™‚ã«è»½ãå›è»¢ã™ã‚‹
- [ ] ãƒã‚¦ãƒ³ã‚¹åŠ¹æœãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ï¼ˆease-out-backï¼‰
- [ ] ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒè‡ªç„¶ã§ã‚ã‚‹

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// app/core/src/systems/effects.rs (MergeAnimationæ‹¡å¼µ)
pub fn animate_merge_scale(
    mut commands: Commands,
    mut query: Query<(Entity, &mut Transform, &mut MergeAnimation)>,
    time: Res<Time>,
) {
    for (entity, mut transform, mut anim) in query.iter_mut() {
        anim.elapsed += time.delta_seconds();

        if anim.elapsed >= anim.duration {
            transform.scale = Vec3::splat(anim.target_scale);
            transform.rotation = Quat::IDENTITY;
            commands.entity(entity).remove::<MergeAnimation>();
        } else {
            let t = anim.elapsed / anim.duration;

            // Ease-out-backï¼ˆãƒã‚¦ãƒ³ã‚¹åŠ¹æœï¼‰
            let c1 = 1.70158;
            let c3 = c1 + 1.0;
            let ease_t = 1.0 + c3 * (t - 1.0).powi(3) + c1 * (t - 1.0).powi(2);

            let scale = anim.start_scale + (anim.target_scale - anim.start_scale) * ease_t;
            transform.scale = Vec3::splat(scale);

            // è»½ã„å›è»¢
            let rotation_angle = (1.0 - t) * std::f32::consts::PI * 0.5;
            transform.rotation = Quat::from_rotation_z(rotation_angle);
        }
    }
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [03_physics_rendering.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³5.1](../03_physics_rendering.md)

---

### ã‚¿ã‚¹ã‚¯ 8.8: ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆã¨ãƒ†ã‚¹ãƒˆ

**å„ªå…ˆåº¦**: P0
**æ¨å®šå·¥æ•°**: 0.5æ™‚é–“
**ãƒ©ãƒ™ãƒ«**: task, phase-8, integration

**èª¬æ˜**:
Phase 8ã§å®Ÿè£…ã—ãŸã™ã¹ã¦ã®ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã«çµ±åˆã™ã‚‹ã€‚

**å—ã‘å…¥ã‚ŒåŸºæº–**:
- [ ] ã™ã¹ã¦ã®ã‚·ã‚¹ãƒ†ãƒ ãŒmain.rsã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè¡Œé †åºãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `cargo run` ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒå‹•ä½œã™ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«å•é¡ŒãŒãªã„ï¼ˆ60fpsç¶­æŒï¼‰

**å®Ÿè£…ã‚¬ã‚¤ãƒ‰**:
```rust
// main.rs
use suika_game_core::systems::*;

fn main() {
    App::new()
        // ... ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
        .add_systems(Update, (
            // ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«
            particles::spawn_merge_particles,
            particles::spawn_watermelon_effect,
            particles::update_particles,

            // ã‚«ãƒ¡ãƒ©ã‚·ã‚§ã‚¤ã‚¯
            camera_shake::trigger_shake_on_merge,
            camera_shake::apply_camera_shake,

            // ãã®ä»–ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
            effects::apply_depth_scale,
        ).run_if(in_state(AppState::Playing)))
        .run();
}
```

**é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**:
- [02_architecture.md - ã‚»ã‚¯ã‚·ãƒ§ãƒ³2.4](../02_architecture.md)

---

## ãƒ•ã‚§ãƒ¼ã‚ºæ¤œè¨¼

### æ¤œè¨¼é …ç›®

- [ ] ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] `cargo build --workspace` ãŒæˆåŠŸã™ã‚‹
- [ ] `cargo run` ã§ã‚²ãƒ¼ãƒ ãŒèµ·å‹•ã™ã‚‹
- [ ] ãƒ•ãƒ«ãƒ¼ãƒ„åˆä½“æ™‚ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒé£›ã³æ•£ã‚‹
- [ ] å¤§ããªãƒ•ãƒ«ãƒ¼ãƒ„ã®åˆä½“æ™‚ã«ç”»é¢ãŒæºã‚Œã‚‹
- [ ] ã‚¹ã‚¤ã‚«å®Œæˆæ™‚ã«è™¹è‰²ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã¨å¼·ã„ã‚·ã‚§ã‚¤ã‚¯ãŒç™ºç”Ÿã™ã‚‹
- [ ] ã‚¹ã‚³ã‚¢åŠ ç®—æ™‚ã«ã‚¹ã‚³ã‚¢è¡¨ç¤ºãŒãƒ‘ãƒ«ã‚¹ã™ã‚‹
- [ ] ãƒ•ãƒ«ãƒ¼ãƒ„å‡ºç¾æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ”¹å–„ã•ã‚Œã¦ã„ã‚‹
- [ ] 2.5Dæ·±åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒæ©Ÿèƒ½ã—ã¦ã„ã‚‹
- [ ] 60fpsä»¥ä¸Šã‚’ç¶­æŒã—ã¦ã„ã‚‹

### æ¤œè¨¼æ‰‹é †

```bash
# ã‚²ãƒ¼ãƒ å®Ÿè¡Œ
cargo run

# ç¢ºèªé …ç›®:
# 1. ãƒ•ãƒ«ãƒ¼ãƒ„ã‚’åˆä½“ã•ã›ã‚‹ã¨ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒé£›ã³æ•£ã‚‹
# 2. å¤§ãã„ãƒ•ãƒ«ãƒ¼ãƒ„ï¼ˆæ¡ƒä»¥ä¸Šï¼‰ã®åˆä½“ã§ç”»é¢ãŒæºã‚Œã‚‹
# 3. ã‚¹ã‚¤ã‚«ã‚’ä½œæˆã™ã‚‹ã¨è™¹è‰²ã®ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã¨å¼·ã„ã‚·ã‚§ã‚¤ã‚¯ãŒç™ºç”Ÿ
# 4. ã‚¹ã‚³ã‚¢ãŒåŠ ç®—ã•ã‚Œã‚‹ã¨ã‚¹ã‚³ã‚¢è¡¨ç¤ºãŒä¸€ç¬å¤§ãããªã‚‹
# 5. ãƒ•ãƒ«ãƒ¼ãƒ„ãŒå‡ºç¾æ™‚ã«å›è»¢ã—ãªãŒã‚‰æ‹¡å¤§ã™ã‚‹
# 6. ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãŒè‡ªç„¶ã«è½ä¸‹ã—ã¦æ¶ˆãˆã‚‹
# 7. ã‚¨ãƒ•ã‚§ã‚¯ãƒˆãŒé‡ãªã£ã¦ã‚‚ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãŒå®‰å®šã—ã¦ã„ã‚‹
```

## å®Œäº†æ¡ä»¶

- [ ] ã™ã¹ã¦ã®ã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] ã™ã¹ã¦ã®æ¤œè¨¼é …ç›®ãŒåˆæ ¼ã—ã¦ã„ã‚‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼ˆå¿…è¦ãªå ´åˆï¼‰
- [ ] ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ï¼ˆ`just fmt`ï¼‰
- [ ] Clippyãƒã‚§ãƒƒã‚¯ãŒé€šã£ã¦ã„ã‚‹ï¼ˆ`just clippy`ï¼‰

## æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º

Phase 8å®Œäº† â†’ æ¬¡ã¯ **Phase 9: ã‚µã‚¦ãƒ³ãƒ‰çµ±åˆ** ã«é€²ã‚€

## å‚™è€ƒ

- Phase 8å®Œäº†æ™‚ç‚¹ã§ã€ã‚²ãƒ¼ãƒ ãŒè¦–è¦šçš„ã«é­…åŠ›çš„ã«ãªã‚‹
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã¯ç°¡æ˜“çš„ãªå®Ÿè£…ï¼ˆæœ¬æ ¼çš„ãªãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½¿ç”¨ã—ãªã„ï¼‰
- ç”»é¢ã‚·ã‚§ã‚¤ã‚¯ã®å¼·åº¦ã¯å¾Œã§èª¿æ•´å¯èƒ½ï¼ˆPhase 10ã§å¾®èª¿æ•´ï¼‰
- 2.5Dæ·±åº¦ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã¯ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡ŒãŒã‚ã‚Œã°ç„¡åŠ¹åŒ–ï¼‰
- ã‚ˆã‚Šé«˜åº¦ãªã‚¨ãƒ•ã‚§ã‚¯ãƒˆï¼ˆãƒ–ãƒ©ãƒ¼ã€ã‚°ãƒ­ãƒ¼ç­‰ï¼‰ã¯å°†æ¥ã®æ‹¡å¼µã¨ã—ã¦æ¤œè¨
- ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¯ãƒ«æ•°ãŒå¤šã„å ´åˆã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã«æ³¨æ„

---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**æœ€çµ‚æ›´æ–°**: 2026-02-15
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœªç€æ‰‹
