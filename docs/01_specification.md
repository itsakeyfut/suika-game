# スイカゲーム - ゲーム仕様書

## 1. ゲーム概要

### 1.1 プロジェクト概要
本プロジェクトは、Bevyゲームエンジンを使用して「スイカゲーム（Suika Game）」のクローンを作成する学習プロジェクトです。物理エンジンを活用した2.5D落ちものパズルゲームの実装を通じて、ゲーム開発の知見を得ることを目的としています。

### 1.2 ゲームジャンル
- **ジャンル**: 物理パズルゲーム、落ちものパズル
- **視点**: 2.5D斜め俯瞰視点（Oblique Overhead View）
- **プレイ人数**: 1人
- **難易度**: 簡単なルール、奥深い戦略性

### 1.3 ゲームの目的
プレイヤーは箱（コンテナ）の中にフルーツを落とし、同じ種類のフルーツ同士を接触させて合体させることで、より大きなフルーツへと進化させていきます。最終目標は最も大きなフルーツである「スイカ」を作成することです。

## 2. 基本ルール

### 2.1 ゲームの流れ
1. **フルーツの出現**: 画面上部からランダムなフルーツが1つ表示される
2. **位置決定**: プレイヤーはマウスまたはキーボードで落下位置を決定
3. **落下**: フルーツが重力に従って落下し、既存のフルーツや箱の底に着地
4. **合体判定**: 同じ種類のフルーツが接触すると合体し、次の段階のフルーツに進化
5. **スコア加算**: 合体時にポイントが加算される
6. **繰り返し**: 次のフルーツが出現し、1～5を繰り返す

### 2.2 ゲームオーバー条件
- フルーツが箱の上部に設定された境界線（デッドライン）を超えた状態が **3.0秒** 継続した場合、ゲームオーバー
- 境界線を一時的に超えても、すぐにはゲームオーバーにならず、警告が表示される
- フルーツが境界線を下回れば即座にタイマーがリセットされる
- 警告中は境界線が赤く点滅（1秒間隔）してプレイヤーに警告

### 2.3 得点システム
- フルーツ同士が合体した際にポイントが加算される
- より大きなフルーツほど高得点（例: スイカの合体は最高得点）
- 連続合体（コンボ）でボーナスポイント
- ハイスコアはローカルに保存され、次回プレイ時にも表示される

#### 2.3.1 コンボシステム詳細

**コンボ認定条件**
- 前回の合体から **2.0秒以内** に次の合体が発生した場合、コンボとして認定
- コンボカウンターは最大10まで
- 2.0秒以上合体が発生しない場合、コンボカウンターはリセットされる

**スコアボーナス計算**
コンボ数に応じて追加ボーナス:
- 2コンボ: 基本得点の +10%
- 3コンボ: 基本得点の +20%
- 4コンボ: 基本得点の +30%
- 5コンボ以上: 基本得点の +50%

**コンボリセット条件**
- 2.0秒以上合体が発生しない
- ゲームオーバー
- 新規ゲーム開始時

## 3. フルーツ進化システム

### 3.1 フルーツの種類（11段階）
オリジナルのスイカゲームに基づく11段階の進化チェーン：

| 段階 | フルーツ名 | 説明 |
|------|-----------|------|
| 1 | サクランボ (Cherry) | 最小のフルーツ、出現可能 |
| 2 | イチゴ (Strawberry) | 小さいフルーツ、出現可能 |
| 3 | ブドウ (Grape) | 小さいフルーツ、出現可能 |
| 4 | デコポン (Dekopon) | 小〜中サイズ、出現可能 |
| 5 | 柿 (Persimmon) | 中サイズ、出現可能 |
| 6 | リンゴ (Apple) | 中サイズ、合体でのみ出現 |
| 7 | 梨 (Pear) | 中〜大サイズ、合体でのみ出現 |
| 8 | 桃 (Peach) | 大サイズ、合体でのみ出現 |
| 9 | パイナップル (Pineapple) | 大サイズ、合体でのみ出現 |
| 10 | メロン (Melon) | 最大級サイズ、合体でのみ出現 |
| 11 | スイカ (Watermelon) | 最大サイズ、合体でのみ出現 |

### 3.2 進化ルール
- **基本進化**: 同じ種類のフルーツ2つが接触すると、次の段階のフルーツ1つに進化
  - 例: サクランボ + サクランボ → イチゴ
  - 例: メロン + メロン → スイカ
- **スイカの特殊ルール**: スイカ同士が接触すると、両方とも消滅する（次の段階は存在しない）
- **合体位置**: 新しいフルーツは2つのフルーツの接触点に出現

### 3.3 出現システム
- **出現可能フルーツ**: プレイヤーが落とせるのは柿（段階5）以下のフルーツのみ
  - サクランボ、イチゴ、ブドウ、デコポン、柿の5種類からランダムに選ばれる
- **次のフルーツ予告**: 次に出現するフルーツを画面左上に常時表示
- **ランダム性**: 完全ランダム選択（重み付けなし）

## 4. 物理シミュレーション要件

### 4.1 重力システム
- フルーツは常に下向きの重力の影響を受ける
- 重力加速度は調整可能（快適なゲームプレイのため）
- 落下速度は物理演算により自然に決定される

### 4.2 衝突判定
- **フルーツ同士の衝突**: 弾性衝突により跳ね返る
- **壁との衝突**: 箱の左右の壁および底面で跳ね返る
- **衝突検出**: 円形コライダーを使用した正確な衝突判定
- **摩擦**: フルーツ表面の摩擦により転がり動作を実現

### 4.3 Jiggle Effect（揺れエフェクト）
- フルーツが着地した後、少し揺れながら静止する自然な物理挙動
- 反発係数（Restitution）と減衰により実現
- 落下の高さや衝撃の強さに応じて揺れの大きさが変化

### 4.4 合体メカニクス
- **接触検出**: 同じ種類のフルーツが物理的に接触した瞬間に合体を開始
- **合体アニメーション**: 2つのフルーツが消え、新しいフルーツが出現するトランジション
- **物理的整合性**: 新しいフルーツは接触点に出現し、運動量を継承（オプション）

## 5. ゲームモード

### 5.1 基本モード（スコアアタック）
- **目的**: 箱から溢れるまでできるだけ高いスコアを目指す
- **時間制限**: なし（フルーツが溢れるまで）
- **難易度**: 固定（フルーツの出現確率は変化しない）

### 5.2 将来的な拡張（現在は実装しない）
- タイムアタックモード
- チャレンジモード（特定のフルーツを作る）
- エンドレスモード

## 6. ゲーム画面構成

### 6.1 タイトル画面
- ゲームタイトル表示
- スタートボタン
- 現在のハイスコア表示
- 操作説明（オプション）

### 6.2 メインゲーム画面
- **中央**: ゲームコンテナ（箱）とフルーツ
- **左上**: 次のフルーツプレビュー
- **中央上**: 現在のスコア（大きく表示）
- **右上**: ハイスコア、経過時間
- **右下**: コンボカウンター（連続合体回数）
- **上部境界**: デッドライン（赤い点線）

### 6.3 ゲームオーバー画面
- "GAME OVER" 表示
- 最終スコア
- ハイスコア更新通知（新記録の場合）
- リトライボタン
- タイトルに戻るボタン

## 7. 操作方法

### 7.1 基本操作
- **マウス操作**:
  - マウス移動: フルーツの落下位置を左右に調整
  - 左クリック: フルーツを落下させる
- **キーボード操作**（代替）:
  - 左右矢印キー: フルーツの落下位置を左右に調整
  - スペースキー: フルーツを落下させる

### 7.2 UI操作
- マウスクリックでボタンを押す
- ESCキー: ポーズメニュー（オプション）

## 8. アセット要件

### 8.1 グラフィック
- **フルーツスプライト**: 11種類のピクセルアート（円形）
  - 初期実装ではプレースホルダー（単色の円）を使用
  - 後日、自作のピクセルアートに置き換え
- **背景**: シンプルな単色または グラデーション
- **箱**: 木製の箱の外観（3辺の壁）
- **UIエレメント**: テキスト、ボタン、アイコン

### 8.2 サウンド
- **BGM**:
  - タイトル画面用（軽快なループ）
  - ゲームプレイ用（集中できるアンビエント）
  - ゲームオーバー用（短い悲しいメロディ）
- **効果音**:
  - フルーツ落下音
  - 合体音（フルーツサイズに応じて音程変化）
  - スイカ完成音（特別なファンファーレ）
  - コンボ音
  - ゲームオーバー音
  - UI操作音（ボタンクリック）

## 9. 技術要件

### 9.1 パフォーマンス
- **フレームレート**: 安定した60fps以上
- **物理演算**: 毎フレーム更新、遅延なし
- **メモリ**: 長時間プレイでメモリリークなし

### 9.2 互換性
- **プラットフォーム**: Windows, macOS, Linux（クロスプラットフォーム）
- **最小要件**: 2D物理演算が快適に動作するスペック

## 10. 参考資料

### 10.1 オリジナルゲーム
- スイカゲーム（Aladdin X）
- [Wikipedia - スイカゲーム](https://ja.wikipedia.org/wiki/%E3%82%B9%E3%82%A4%E3%82%AB%E3%82%B2%E3%83%BC%E3%83%A0)

### 10.2 類似実装例
- [Emanuele Feronato - Watermelon Game Tutorial](https://emanueleferonato.com/2024/01/26/build-a-html5-game-like-watermelon-game-using-phaser-and-box2d-powered-by-planck-js-step-1-the-basic-game-mechanics/)

---

**バージョン**: 1.0
**最終更新**: 2026-02-15
**ステータス**: 承認済み
